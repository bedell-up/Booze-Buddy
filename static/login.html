
<!-- login.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login - Booze Buddy</title>
<link rel="stylesheet" href="static/css/style.css">
</head>
<body>
    <div id="message" style="display:none;"></div>

    <div>
        <button class="auth-tab active" data-tab="login">Login</button>
        <button class="auth-tab" data-tab="register">Register</button>
    </div>

    <form id="login-form" class="auth-form active">
        <input type="text" id="login-username" placeholder="Username" required />
        <input type="password" id="login-password" placeholder="Password" required />
        <button type="submit">Login</button>
    </form>

    <form id="register-form" class="auth-form">
        <input type="text" id="register-username" placeholder="Username" required />
        <input type="email" id="register-email" placeholder="Email" required />
        <input type="password" id="register-password" placeholder="Password" required />
        <input type="password" id="register-confirm-password" placeholder="Confirm Password" required />
        <button type="submit">Register</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Login page loaded, clearing any existing tokens");
            localStorage.removeItem('token');
            localStorage.removeItem('token_type');
        });

        let API_BASE_URL = window.location.origin;
        const currentHost = window.location.hostname;
        const hostWithoutWWW = currentHost.replace('www.', '');
        API_BASE_URL = `${window.location.protocol}//${hostWithoutWWW}`;

        console.log("Using API_BASE_URL:", API_BASE_URL);

        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const messageBox = document.getElementById('message');

        authTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                authTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                authForms.forEach(form => form.classList.remove('active'));
                if (tabId === 'login') {
                    loginForm.classList.add('active');
                } else {
                    registerForm.classList.add('active');
                }
                hideMessage();
            });
        });

        function showMessage(text, type) {
            messageBox.textContent = text;
            messageBox.className = `message message-${type}`;
            messageBox.style.display = 'block';
            messageBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function hideMessage() {
            messageBox.style.display = 'none';
        }

        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;

            showMessage('Logging in...', 'info');

            try {
                const formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);

                console.log("Sending login request to:", `${API_BASE_URL}/token`);

                const response = await fetch(`${API_BASE_URL}/token`, {
                    method: 'POST',
                    body: formData
                });

                console.log("Login response status:", response.status);

                if (!response.ok) {
                    let errorMessage = 'Login failed. Please check your credentials.';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || errorMessage;
                    } catch (e) {}
                    throw new Error(errorMessage);
                }

                const data = await response.json();

                localStorage.setItem('token', data.access_token);
                localStorage.setItem('token_type', data.token_type);

                showMessage('Login successful! Redirecting...', 'success');

                setTimeout(() => {
                    const appUrl = `${window.location.protocol}//${window.location.host}/app`;  // <== UPDATED HERE
                    console.log("Redirecting to:", appUrl);
                    window.location.href = appUrl;
                }, 1500);
            } catch (error) {
                console.error('Login error:', error);
                showMessage(error.message || 'Login failed. Please check your credentials.', 'error');
            }
        });

        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;

            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }

            try {
                showMessage('Creating account...', 'info');

                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, email, password })
                });

                if (!response.ok) {
                    let errorMessage = 'Registration failed. Please try again.';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || errorMessage;
                    } catch (e) {}
                    throw new Error(errorMessage);
                }

                const data = await response.json();

                showMessage('Registration successful! Please login.', 'success');
                registerForm.reset();
                authTabs[0].click();
            } catch (error) {
                console.error('Registration error:', error);
                showMessage(error.message || 'Registration failed. Please try again.', 'error');
            }
        });
    </script>
</body>
</html>

    <
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-cocktail"></i> Booze Buddy</h1>
            <p>Your personal cocktail assistant</p>
        </div>
    </header>
    
    <div class="container auth-container">
        <div class="auth-box">
            <div class="auth-tabs">
                <div class="auth-tab active" data-tab="login">Login</div>
                <div class="auth-tab" data-tab="register">Register</div>
            </div>
            
            <div id="message" class="message"></div>
            
            <!-- Login Form -->
            <form id="login-form" class="auth-form active">
                <div class="form-group">
                    <label for="login-username">Username</label>
                    <input type="text" id="login-username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
            
            <!-- Register Form -->
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label for="register-username">Username</label>
                    <input type="text" id="register-username" placeholder="Choose a username" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Password</label>
                    <input type="password" id="register-password" placeholder="Choose a password" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm-password">Confirm Password</label>
                    <input type="password" id="register-confirm-password" placeholder="Confirm your password" required>
                </div>
                <button type="submit" class="btn">Register</button>
            </form>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Booze Buddy. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        // Clear any existing tokens on login page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Login page loaded, clearing any existing tokens");
            localStorage.removeItem('token');
            localStorage.removeItem('token_type');
        });
        
        // More robust API base URL configuration
        let API_BASE_URL = window.location.origin;
        
        // Get the hostname (domain) that the site is currently running on
        const currentHost = window.location.hostname;
        
        // Handle www vs non-www consistently
        const hostWithoutWWW = currentHost.replace('www.', '');
        
        // Build the API URL using the protocol and cleaned hostname
        API_BASE_URL = `${window.location.protocol}//${hostWithoutWWW}`;
        
        // For debugging purposes
        console.log("Using API_BASE_URL:", API_BASE_URL);
        
        // DOM Elements
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const messageBox = document.getElementById('message');
        
        // Switch between login and register tabs
        authTabs.forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // Update active tab
                authTabs.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                // Update active form
                authForms.forEach(form => form.classList.remove('active'));
                if (tabId === 'login') {
                    loginForm.classList.add('active');
                } else {
                    registerForm.classList.add('active');
                }
                
                // Clear message
                hideMessage();
            });
        });
        
        // Show message
        function showMessage(text, type) {
            messageBox.textContent = text;
            messageBox.className = `message message-${type}`;
            messageBox.style.display = 'block';
            
            // Scroll to message
            messageBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // Hide message
        function hideMessage() {
            messageBox.style.display = 'none';
        }
        
        // Handle login
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            showMessage('Logging in...', 'info');
            
            try {
                const formData = new FormData();
                formData.append('username', username);
                formData.append('password', password);
                
                console.log("Sending login request to:", `${API_BASE_URL}/token`);
                
                const response = await fetch(`${API_BASE_URL}/token`, {
                    method: 'POST',
                    body: formData
                });
                
                console.log("Login response status:", response.status);
                
                if (!response.ok) {
                    let errorMessage = 'Login failed. Please check your credentials.';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || errorMessage;
                    } catch (e) {
                        // If response is not JSON, use default error message
                    }
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                
                // Save token and redirect
                localStorage.setItem('token', data.access_token);
                localStorage.setItem('token_type', data.token_type);
                
                showMessage('Login successful! Redirecting...', 'success');
                
                // Use timeout to ensure message is seen
                setTimeout(() => {
                    window.location.href = '/';
                }, 1500);
            } catch (error) {
                console.error('Login error:', error);
                showMessage(error.message || 'Login failed. Please check your credentials.', 'error');
            }
        });
        
        // Handle registration
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            // Check if passwords match
            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'error');
                return;
            }
            
            try {
                showMessage('Creating account...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username,
                        email,
                        password
                    })
                });
                
                if (!response.ok) {
                    let errorMessage = 'Registration failed. Please try again.';
                    try {
                        const error = await response.json();
                        errorMessage = error.detail || errorMessage;
                    } catch (e) {
                        // If response is not JSON, use default error message
                    }
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                
                // Show success message and switch to login tab
                showMessage('Registration successful! Please login.', 'success');
                
                // Clear form
                registerForm.reset();
                
                // Switch to login tab
                authTabs[0].click();
            } catch (error) {
                console.error('Registration error:', error);
                showMessage(error.message || 'Registration failed. Please try again.', 'error');
            }
        });
    </script>
</body>
</html>
